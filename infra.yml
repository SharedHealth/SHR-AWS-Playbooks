---
- hosts: all
  roles:
    - vpc
  vars_files:
    - "group_vars/secure_vars.yml"
    - "group_vars/vars.yml"
    - "group_vars/cidr_blocks.yml"
    tags:
      - create-vpc

- hosts: all
  roles:
    - fetch-facts
    - ec2-instance
  vars_files:
    - "group_vars/secure_vars.yml"
    - "group_vars/vars.yml"
    - "group_vars/cidr_blocks.yml"
    - "configs/bastion.yml"
    - "configs/build-server.yml"
    - "configs/proxy-server.yml"
    - "configs/instances.yml"
  tags:
    - setup_instance

- hosts: all
  roles:
    - haproxy
  vars_files:
    - "group_vars/secure_vars.yml"
    - "group_vars/vars.yml"
    - "group_vars/cidr_blocks.yml"
    - "configs/bastion.yml"
    - "configs/build-server.yml"
    - "configs/proxy-server.yml"
    - "configs/instances.yml"
  tags:
    - proxy